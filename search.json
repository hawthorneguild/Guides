---
layout: null
permalink: /search.json
---
[
  {% assign search_docs = site.pages | concat: site.posts %}
  
  {% for collection in site.collections %}
    {% if collection.label != 'posts' %}
      {% assign search_docs = search_docs | concat: collection.docs %}
    {% endif %}
  {% endfor %}

  {% for doc in search_docs %}
    {% if doc.content and doc.url != "/404.html" and doc.exclude_from_search != true %}

      {% comment %}
        NEW: This block captures all text from h1-h6 tags.
      {% endcomment %}
      {% capture headers %}
        {% assign heading_parts = doc.content | split: '<h' %}
        {% for part in heading_parts offset:1 %}
          {% assign h_content = part | split: '</h' | first | split: '>' | last %}
          {{ h_content | strip_html | strip_newlines | append: " " }}
        {% endfor %}
      {% endcapture %}

      {
        "title": {{ doc.title | strip_html | strip_newlines | jsonify }},
        "url": "{{ doc.url | absolute_url | xml_escape }}",
        "date": "{{ doc.date | date: "%Y-%m-%d" }}",
        "headers": {{ headers | strip_newlines | jsonify }},
        "content": {{ doc.content | strip_html | strip_newlines | jsonify }}
      }
      {% unless forloop.last %},{% endunless %}
    {% endif %}
  {% endfor %}
]